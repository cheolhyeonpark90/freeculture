name: FreeCulture ë°ì´í„° ìˆ˜ì§‘

on:
  # âŠ GitHub UIì—ì„œ ì–¸ì œë“  ì§ì ‘ ì‹¤í–‰
  workflow_dispatch:

  # â‹ main ë¸Œëœì¹˜ì— ì»¤ë°‹ì´ ì˜¬ë¼ì˜¬ ë•Œë§ˆë‹¤ ì‹¤í–‰
  push:
    branches: [main]

  # âŒ ë§¤ì¼ ì˜¤ì „ 10:00 KST(= 01:00 UTC) ìë™ ì‹¤í–‰
  schedule:
    - cron: '0 1 * * 3'

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest

    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: ğŸ“¦ Checkout
        uses: actions/checkout@v4

      # 2. Node.js 22 ì„¤ì¹˜
      - name: ğŸ› ï¸ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      # 3. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (axiosÂ·dotenv)
      - name: ğŸ“¦ Install dependencies
        run: npm install axios dotenv

      # 4. ë°ì´í„° ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: ğŸƒ Run fetch.js
        env:
          FREE_CULTURE_API_KEY: ${{ secrets.FREE_CULTURE_API_KEY }}
        run: node fetch.js

      # 5. ê²°ê³¼ íŒŒì¼ ì»¤ë°‹ & í‘¸ì‹œ
      - name: ğŸ’¾ Commit and push result
        run: |
          git config user.name  "github-actions"
          git config user.email "actions@github.com"
          git add freeculture_data.json
          git commit -m "ğŸ¤– ìë™ ìˆ˜ì§‘: $(date -u '+%Y-%m-%dT%H:%M:%SZ')" || echo "No changes"
          git push
